<script>
const API_URL = "https://geosafe-backend.vercel.app"; // <-- tu URL real del backend

// Crear el mapa Leaflet
const map = L.map('map').setView([6.2442, -75.5812], 12); // MedellÃ­n
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Cargar marcadores guardados
async function loadMarkers() {
  try {
    const res = await fetch(`${API_URL}/markers`);
    const data = await res.json();
    data.markers.forEach(m => {
      L.marker([m.lat, m.lng]).addTo(map);
    });
  } catch (err) {
    console.error("Error cargando marcadores:", err);
  }
}

// Guardar nuevo marcador
async function saveMarker(lat, lng) {
  try {
    const res = await fetch(`${API_URL}/markers?lat=${lat}&lng=${lng}`, {
      method: 'POST'
    });
    const data = await res.json();
    console.log("Marcador guardado:", data);
  } catch (err) {
    console.error("Error guardando marcador:", err);
  }
}

// Evento click para colocar marcador
map.on('click', async (e) => {
  const { lat, lng } = e.latlng;
  L.marker([lat, lng]).addTo(map);
  await saveMarker(lat, lng);
});

loadMarkers();
</script>

